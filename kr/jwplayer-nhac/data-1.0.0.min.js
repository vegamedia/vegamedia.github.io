/*!
 * Nhac Web Karaoke plugin for JW7 v1.0.0 support BigData
 * Copyright 2017 Nhac.vn, Vega Corp
 * Dev by Tan Vu â„¢
 * http://nhac.vn - 2017-08-22
 */
(function(H){H().registerPlugin("data","6.0",function(f,c,H){function I(){c.performance&&"undefined"!==typeof A&&"function"===typeof A&&(d=new Date,"playing"==f.getState()?(r+=(d-g)/1E3,k.playing=Math.round(r),0==m&&(h.play=++m),0==t&&0<u&&(h.pause=++t)):"paused"==f.getState()?(u+=(d-g)/1E3,k.pause=Math.round(u),0==t&&(h.pause=++t),0==m&&0<r&&(h.play=++m)):"buffering"==f.getState()&&(v+=(d-g)/1E3,k.buffer=Math.round(v),0==m&&(h.play=m)),d=new Date,l[e]+=Math.round((d-q)/1E3),q=new Date,A(),J())}function J(){g=
new Date;u=r=v=0;k={error:0,idle:0,buffer:0,playing:0,pause:0};B=C=D=m=t=E=0;h={seek:0,pause:0,play:0,user_change_profile:0,auto_change_profile:0,change_caption:0};for(var a in l)l[a]=0}function L(){hostmode||(F=1);for(var a in K){var c=K[a];if(c.r.test(n)){os=c.s;break}}/Windows/.test(os)&&(osVersion=/Windows (.*)/.exec(os)[1],os="Windows");switch(os){case "Mac OS X":osVersion=/Mac OS X (10[\.\_\d]+)/.exec(n)[1];break;case "Android":osVersion=/Android ([\.\_\d]+)/.exec(n)[1];break;case "iOS":osVersion=
/OS (\d+)_(\d+)_?(\d+)?/.exec(nVer),osVersion=osVersion[1]+"."+osVersion[2]+"."+(osVersion[3]|0)}a=n.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(a[1])){var b=/\brv[ :]+(\d+)/g.exec(n)||[];return"IE "+(b[1]||"")}if("Chrome"===a[1]&&(b=n.match(/\b(OPR|Edge)\/(\d+)/),null!=b))return b.slice(1).join(" ").replace("OPR","Opera");a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(b=n.match(/version\/(\d+)/i))&&a.splice(1,1,b[1]);G=a[0].toLowerCase();
browser_version=a[1]}function A(){void 0==G&&("function"===typeof f.duration?duration_time=Math.round(f.duration()):"function"===typeof f.getDuration&&(duration_time=Math.round(f.getDuration())),L());Number.prototype.padLeft=function(a,c){var b=String(a||10).length-String(this).length+1;return 0<b?Array(b).join(c||"0")+this:this};var a=new Date,e=[a.getFullYear(),(a.getMonth()+1).padLeft(),a.getDate().padLeft()].join("-")+" "+[a.getHours().padLeft(),a.getMinutes().padLeft(),a.getSeconds().padLeft()].join(":");
a=Math.round(a.getTime()/1E3);var d=-1;"function"===typeof f.currentTime?d=Math.round(f.currentTime()):"function"===typeof f.getPosition&&(d=Math.round(f.getPosition()));b.ctime=a;b.du=x;b.uid=c.user_id;b.vid=c.vega_id;b.msi=c.msisdn;b.pid=c.package_id;b.cid=c.content_id;b.aid=c.album_id;b.ctype=c.content_type;b.uso=c.utm_source;b.ume=c.utm_medium;b.ute=c.utm_term;b.uco=c.utm_content;b.uca=c.utm_campaign;b.em=F;b.pst=k;b.event=h;b.pro=l;b.pos=d;b.dti=duration_time;b.os=os.toLowerCase();b.osv=osVersion;
b.br=G;b.brv=browser_version;b.did=c.device_id;b.c=c.channel;b.s=c.session_id;b.ua=n;b.url=onsite;b.ref=c.url_referer;b.act=c.action_type;b.ptype=c.player_type;b.sid=c.service_id;b.sr=c.source_rec;b.lst="online";b.o=c.other_info;b.etime=c.expired_time;b.cstr=e;b.v=c.version;a=btoa(JSON.stringify(b));c.perform_debug&&(console.log("player_states:::",k),console.log("events::::::::::",h),console.log("profiles_time:::",l),console.log("datas:::::::::::",b),console.log("dformat:::::::::",e));e=new XMLHttpRequest;
e.open("GET","https://collect.ovp.vn/nhac_collect?data="+a,!1);e.send(null)}var F="?embed=1",K=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},
{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",
r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],n=navigator.userAgent,G,b={},w=0,y=!1,z=!1,p,x=6E4,k={},h={},l={},v=0,r=0,u=0,q,g=new Date,d,E=0,t=0,m=0,D=0,C=0,B=0,e;f.onReady(function(a){c.perform_debug&&console.log("onReady::::::::",c,f.getConfig());k.error=0;0<c.duration&&(x=1E3*c.duration);p=setInterval(I,x);onsite=document.URL;referrer=window.location!=window.parent.location?window.parent.location:document.location;"undefined"==referrer&&
(referrer=onsite);domainReferrer=referrer.hostname;0<=domainReferrer.indexOf("nhac.vn")?(hostmode=!0,void 0!=c&&void 0!=c.mode&&(mode=c.mode)):(hostmode=!1,mode=0<domainReferrer.indexOf(F)?"iframe":"embed");c.modepro=mode});f.on("meta",function(a){d=new Date;c.perform_debug&&console.log("onMeta:::::::::duration",a.duration,a.type,a.width,a.height,f.getState(),g.getTime(),d.getTime(),d-g)});f.on("firstFrame",function(a){d=new Date;c.perform_debug&&console.log("onFirstFrame:::loadTime/type",a.loadTime,
a.type,f.getState(),g.getTime(),d.getTime(),d-g);v+=(d-g)/1E3;g=new Date;y=!0});f.on("buffer",function(a){d=new Date;c.perform_debug&&console.log("onBuffer:::::::oldstate",a.oldstate,g.getTime(),d.getTime(),d-g);"idle"==a.oldstate&&(k.idle=Math.round((d-g)/1E3));g=new Date});f.on("pause",function(a){z?(z=!1,f.play(!0)):(d=new Date,c.perform_debug&&console.log("onPaused:::::::oldstate",a.oldstate,g.getTime(),d.getTime(),d-g),"playing"==a.oldstate&&(r+=(d-g)/1E3,k.playing=Math.round(r)),g=new Date,
h.pause=++t)});f.on("play",function(a){d=new Date;c.perform_debug&&console.log("onPlay:::::::::oldstate",a.oldstate,f.getState(),g.getTime(),d.getTime(),d-g);"buffering"==a.oldstate?(v+=(d-g)/1E3,k.buffer=Math.round(v)):"paused"==a.oldstate&&(u+=(d-g)/1E3,k.pause=Math.round(u));g=new Date;h.play=++m});f.on("playlistItem",function(a){c.perform_debug&&console.log("playlistItem:::::::::evt",a,a.item,a.item.mediaid,c.content_id,c.content_type);if(void 0===c.content_id||"album"===c.content_type)c.content_id=
a.item.mediaid;console.log("playlistItem:::::::::perform",p,y,c.content_id,a.item.mediaid);void 0!=p&&y&&(clearInterval(p),J(),p=setInterval(I,x))});f.on("seek",function(a){c.perform_debug&&console.log("onSeek:::::::::evt",a,E);h.seek=++E});f.on("levels",function(a){var b=a.levels;c.perform_debug&&console.log("levels:::::::::",w,a.currentQuality,a,b);for(var d=0;d<b.length;d++){var g=b[d].label;g.toLowerCase().indexOf("k");"Auto"!=g&&(g=g.replace("p",""),g=g.replace("k",""),g=g.replace("K",""),l[g]=
0)}w=a.currentQuality;if(void 0==e||0==f.getPosition())q=new Date;e=b[a.currentQuality].label;e=e.replace("p","");e=e.replace("k","");e=e.replace("K","")});f.on("visualQuality",function(a){c.perform_debug&&console.log("visualQuality::evt",a,C);h.auto_change_profile=++C;void 0!=e&&0!=f.getPosition()&&(d=new Date,l[e]+=Math.round((d-q)/1E3));q=new Date;e=f.getQualityLevels()[a.level.index].label;e=e.replace("p","");e=e.replace("k","");e=e.replace("K","")});f.on("levelsChanged",function(a){var b=a.levels[0].label;
("Auto"==b||"T\u1ef1 \u0111\u1ed9ng"==b)&&y&&(0<a.currentQuality&&a.currentQuality<w||0==w)&&(z=!0,f.pause(!0));c.perform_debug&&console.log("levelsChanged:::::::::evt",a,D,z);h.user_change_profile=++D;void 0!=e&&(d=new Date,l[e]+=Math.round((d-q)/1E3),q=new Date);e=a.levels[a.currentQuality].label;"Auto"!=e&&(e=e.replace("p",""),e=e.replace("k",""),e=e.replace("K",""));w=a.currentQuality});f.on("captionsChanged",function(a){c.perform_debug&&console.log("captionsChanged:::::::::evt",a,B,f.getPosition());
0<f.getPosition()&&(h.change_caption=++B)});f.on("complete",function(a){c.perform_debug&&console.log("complete",typeof nextUp,p,c.content_type);void 0!=p&&clearInterval(p)});this.resize=function(a,b){}})})(jwplayer);