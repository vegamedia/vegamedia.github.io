/*!
 * Nhac Web Karaoke plugin for JW7 v1.0.0 support BigData
 * Copyright 2017 Nhac.vn, Vega Corp
 * Dev by Tan Vu â„¢
 * http://nhac.vn - 2017-08-22
 */
(function(G){G().registerPlugin("data","6.0",function(d,c,G){function J(){if(c.performance&&"undefined"!==typeof y&&"function"===typeof y){e=new Date;"playing"==d.getState()?(q+=(e-g)/1E3,k.playing=Math.round(q),0==m&&(h.play=++m),0==r&&0<t&&(h.pause=++r)):"paused"==d.getState()?(t+=(e-g)/1E3,k.pause=Math.round(t),0==r&&(h.pause=++r),0==m&&0<q&&(h.play=++m)):"buffering"==d.getState()&&(u+=(e-g)/1E3,k.buffer=Math.round(u),0==m&&(h.play=m));e=new Date;l[f]+=Math.round((e-p)/1E3);p=new Date;y();g=new Date;
t=q=u=0;k={error:0,idle:0,buffer:0,playing:0,pause:0};z=A=B=m=r=C=0;h={seek:0,pause:0,play:0,user_change_profile:0,auto_change_profile:0,change_caption:0};for(var a in l)l[a]=0}}function K(){0<c.duration&&(w=c.duration);hostmode||(D=1);for(var a in H){var b=H[a];if(b.r.test(n)){os=b.s;break}}/Windows/.test(os)&&(osVersion=/Windows (.*)/.exec(os)[1],os="Windows");switch(os){case "Mac OS X":osVersion=/Mac OS X (10[\.\_\d]+)/.exec(n)[1];break;case "Android":osVersion=/Android ([\.\_\d]+)/.exec(n)[1];
break;case "iOS":osVersion=/OS (\d+)_(\d+)_?(\d+)?/.exec(nVer),osVersion=osVersion[1]+"."+osVersion[2]+"."+(osVersion[3]|0)}a=n.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(a[1])){var d=/\brv[ :]+(\d+)/g.exec(n)||[];return"IE "+(d[1]||"")}if("Chrome"===a[1]&&(d=n.match(/\b(OPR|Edge)\/(\d+)/),null!=d))return d.slice(1).join(" ").replace("OPR","Opera");a=a[2]?[a[1],a[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(d=n.match(/version\/(\d+)/i))&&
a.splice(1,1,d[1]);E=a[0].toLowerCase();browser_version=a[1]}function y(){void 0==E&&("function"===typeof d.duration?duration_time=Math.round(d.duration()):"function"===typeof d.getDuration&&(duration_time=Math.round(d.getDuration())),K());Number.prototype.padLeft=function(a,c){var b=String(a||10).length-String(this).length+1;return 0<b?Array(b).join(c||"0")+this:this};var a=new Date,f=[a.getFullYear(),(a.getMonth()+1).padLeft(),a.getDate().padLeft()].join("-")+" "+[a.getHours().padLeft(),a.getMinutes().padLeft(),
a.getSeconds().padLeft()].join(":");a=Math.round(a.getTime()/1E3);var e=-1;"function"===typeof d.currentTime?e=Math.round(d.currentTime()):"function"===typeof d.getPosition&&(e=Math.round(d.getPosition()));b.ctime=a;b.du=w;b.uid=c.user_id;b.vid=c.vega_id;b.msi=c.msisdn;b.pid=c.package_id;b.cid=c.content_id;b.aid=c.album_id;b.ctype=c.content_type;b.uso=c.utm_source;b.ume=c.utm_medium;b.ute=c.utm_term;b.uco=c.utm_content;b.uca=c.utm_campaign;b.em=D;b.pst=k;b.event=h;b.pro=l;b.pos=e;b.dti=duration_time;
b.os=os.toLowerCase();b.osv=osVersion;b.br=E;b.brv=browser_version;b.did=c.device_id;b.c=c.channel;b.s=c.session_id;b.ua=n;b.url=onsite;b.ref=c.url_referer;b.act=c.action_type;b.ptype=c.player_type;b.sid=c.service_id;b.sr=c.source_rec;b.lst="online";b.o=c.other_info;b.etime=c.expired_time;b.cstr=f;b.v=c.version;a=btoa(JSON.stringify(b));c.perform_debug&&(console.log("player_states:::",k),console.log("events::::::::::",h),console.log("profiles_time:::",l),console.log("datas:::::::::::",b),console.log("dformat:::::::::",
f));f=new XMLHttpRequest;f.open("GET","https://collect.ovp.vn/nhac_collect?data="+a,!1);f.send(null)}var D="?embed=1",H=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},
{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},
{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],n=navigator.userAgent,E,b={},v=0,I=!1,x=!1,F,w=6E4,k={},h={},l={},u=0,q=0,t=0,p,g=new Date,e,C=0,r=0,m=0,B=0,A=0,z=0,f;d.onReady(function(a){c.perform_debug&&console.log("onReady::::::::",c,d.getConfig());k.error=0;0<c.duration&&(w=1E3*c.duration);F=setInterval(J,w);onsite=document.URL;referrer=window.location!=window.parent.location?window.parent.location:
document.location;"undefined"==referrer&&(referrer=onsite);domainReferrer=referrer.hostname;0<=domainReferrer.indexOf("nhac.vn")?(hostmode=!0,void 0!=c&&void 0!=c.mode&&(mode=c.mode)):(hostmode=!1,mode=0<domainReferrer.indexOf(D)?"iframe":"embed");c.modepro=mode});d.on("meta",function(a){e=new Date;c.perform_debug&&console.log("onMeta:::::::::duration",a.duration,a.type,a.width,a.height,d.getState(),g.getTime(),e.getTime(),e-g)});d.on("firstFrame",function(a){e=new Date;c.perform_debug&&console.log("onFirstFrame:::loadTime/type",
a.loadTime,a.type,d.getState(),g.getTime(),e.getTime(),e-g);u+=(e-g)/1E3;g=new Date;I=!0});d.on("buffer",function(a){e=new Date;c.perform_debug&&console.log("onBuffer:::::::oldstate",a.oldstate,g.getTime(),e.getTime(),e-g);"idle"==a.oldstate&&(k.idle=Math.round((e-g)/1E3));g=new Date});d.on("pause",function(a){x?(x=!1,d.play(!0)):(e=new Date,c.perform_debug&&console.log("onPaused:::::::oldstate",a.oldstate,g.getTime(),e.getTime(),e-g),"playing"==a.oldstate&&(q+=(e-g)/1E3,k.playing=Math.round(q)),
g=new Date,h.pause=++r)});d.on("play",function(a){e=new Date;c.perform_debug&&console.log("onPlay:::::::::oldstate",a.oldstate,d.getState(),g.getTime(),e.getTime(),e-g);"buffering"==a.oldstate?(u+=(e-g)/1E3,k.buffer=Math.round(u)):"paused"==a.oldstate&&(t+=(e-g)/1E3,k.pause=Math.round(t));g=new Date;h.play=++m});d.on("seek",function(a){c.perform_debug&&console.log("onSeek:::::::::evt",a,C);h.seek=++C});d.on("levels",function(a){var b=a.levels;c.perform_debug&&console.log("levels:::::::::",v,a.currentQuality,
a,b);for(var e=0;e<b.length;e++){var g=b[e].label;g.toLowerCase().indexOf("k");"Auto"!=g&&(g=g.replace("p",""),g=g.replace("k",""),g=g.replace("K",""),l[g]=0)}v=a.currentQuality;if(void 0==f||0==d.getPosition())p=new Date;f=b[a.currentQuality].label;f=f.replace("p","");f=f.replace("k","");f=f.replace("K","")});d.on("visualQuality",function(a){c.perform_debug&&console.log("visualQuality::evt",a,A);h.auto_change_profile=++A;void 0!=f&&0!=d.getPosition()&&(e=new Date,l[f]+=Math.round((e-p)/1E3));p=new Date;
f=d.getQualityLevels()[a.level.index].label;f=f.replace("p","");f=f.replace("k","");f=f.replace("K","")});d.on("levelsChanged",function(a){var b=a.levels[0].label;("Auto"==b||"T\u1ef1 \u0111\u1ed9ng"==b)&&I&&(0<a.currentQuality&&a.currentQuality<v||0==v)&&(x=!0,d.pause(!0));c.perform_debug&&console.log("levelsChanged:::::::::evt",a,B,x);h.user_change_profile=++B;void 0!=f&&(e=new Date,l[f]+=Math.round((e-p)/1E3),p=new Date);f=a.levels[a.currentQuality].label;"Auto"!=f&&(f=f.replace("p",""),f=f.replace("k",
""),f=f.replace("K",""));v=a.currentQuality});d.on("captionsChanged",function(a){c.perform_debug&&console.log("captionsChanged:::::::::evt",a,z,d.getPosition());0<d.getPosition()&&(h.change_caption=++z)});d.on("complete",function(a){void 0!=F&&clearInterval(F)});this.resize=function(a,b){}})})(jwplayer);