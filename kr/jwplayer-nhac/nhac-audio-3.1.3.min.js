/*!
 * Nhac Web plugin for JW7 v3.1.4 support Audio, remove Auto, Karaoke
 * Copyright 2017 Nhac.vn, Vega Corp
 * http://nhac.vn - 2017-09-26
 */
(function(B){B().registerPlugin("nhac","6.0",function(f,p,x){function B(){if(void 0==p.showAutoNext||p.showAutoNext){if(void 0==t){var a=u.getElementsByClassName("jw-icon-hd")[0];void 0!=a&&(t=document.createElement("div"),t.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-auto-next jw-icon-auto-next-on",t.onclick=function(){"jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-auto-next jw-icon-auto-next-on"==t.className?(t.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-auto-next jw-icon-auto-next-off",
"function"===typeof onPlayerAutoNextOff&&onPlayerAutoNextOff()):(t.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-auto-next jw-icon-auto-next-on","function"===typeof onPlayerAutoNextOn&&onPlayerAutoNextOn())},a.parentNode.insertBefore(t,a))}void 0==C&&(a=u.getElementsByClassName("jw-icon-playback")[0],void 0!=a&&(C=document.createElement("div"),C.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-nextsong",C.onclick=function(){"function"===typeof onPlayerAutoNext&&
onPlayerAutoNext()},a.parentNode.insertBefore(C,a.nextSibling)))}}function M(){if(void 0==w){var a=u.getElementsByClassName("jw-icon-hd")[0];void 0!=a&&(w=document.createElement("div"),w.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-lyric",w.onclick=function(){"jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-lyric"==w.className?(w.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-lyric jw-toggle jw-off",n.style.visibility="hidden"):(w.className="jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-lyric",
n.style.visibility="visible")},a.parentNode.insertBefore(w,a.nextSibling))}}function E(a){if(!D)if(null!=f.getConfig().captionsTrack&&0<f.getConfig().captionsTrack.cues.length){D=!0;a=f.getConfig().captionsTrack.cues;if(2<a.length){var d=a[1].text.toLowerCase();if(0<=d.indexOf("s\u00e1ng t\u00e1c")||0<=d.indexOf("ca s\u0129"))a[0].startTime=0}if(p.resounded)for(var b=1;b<a.length;b++){d=a[b-1].text;var c=(d.match(/([\s]+)/g)||[]).length+1,g=a[b-1].endTime-a[b-1].startTime,l=g/c,h=a[b].startTime-a[b-
1].endTime;p.lyric_debug&&console.log("i@@@@@@@@",b,Math.round(100*g)/100,"/",c,"=",Math.round(100*l)/100,"|",Math.round(100*h)/100,d);if(4<b){var e=a[b-1].startTime-a[b-2].endTime,m=a[b-2].startTime-a[b-3].endTime;if(.5<h&&.2>e&&.2>m)1.2<h&&(g=d.substr(d.length-1),a[b-1].text+=g+g+"."),a[b-1].text+="...",p.lyric_debug&&console.log("i i-1 i-2",b,b-1,b-2,h,Math.round(100*e)/100,Math.round(100*m)/100,.5<h,.2>e,.2>m);else if(.9<l){e=(a[b-2].text.match(/([\s]+)/g)||[]).length+1;m=a[b-2].endTime-a[b-2].startTime;
var r=m/e;h=g-r*c;p.lyric_debug&&(console.log("diiiiiiii",Math.round(100*g)/100,"/",c,"=",Math.round(100*l)/100),console.log("diiiiiiii",Math.round(100*m)/100,"/",e,"=",Math.round(100*r)/100),console.log("diiiiiiii",b,Math.round(100*r)/100,"*",c,"=",Math.round(r*c*100)/100,"|",Math.round(100*g)/100,"--",Math.round(100*h)/100,d));2.5<h&&(g=d.substr(d.length-1),a[b-1].text+=g+g+".");1.5<h&&(a[b-1].text+="...")}}}v=-1;k=[{startTime:0,text:""}];for(b=0;b<a.length;b++)k.push(a[b]),k.push({startTime:a[b].endTime,
text:""}),p.resounded&&b<a.length-1&&(g=a[b+1].startTime-a[b].endTime,10<g&&(d={},30<g?(d.text="5 4 3 2 1",d.startTime=a[b+1].startTime-2):20<g?(d.text="4 3 2 1",d.startTime=a[b+1].startTime-1.5):(d.text="3 2 1",d.startTime=a[b+1].startTime-1),d.endTime=a[b+1].startTime-.5,k.push(d),k.push({startTime:a[b+1].startTime,text:""})));G();M()}else J(a)}function N(a){E("firstFrame2")}function O(a){void 0==q&&(q=u.getElementsByClassName("jw-icon-hd")[0].getElementsByClassName("jw-option"));1==q.length&&(a=
q[0],"128K"==a.innerHTML?K("320K (Login)",320):"128 kbps"==a.innerHTML&&K("320 kbps (Login)",320));E("firstFrame")}function K(a,d){var b=document.createElement("li");b.className="jw-text jw-option jw-item-1 jw-reset";b.innerHTML=a;b.onclick=function(){H=!0;"function"===typeof onPlayerLoginVip&&onPlayerLoginVip(d)};var c=q[q.length-1];c.parentNode.insertBefore(b,c.nextSibling)}function P(a){H&&(H=!1,f.setCurrentQuality(0))}function J(a){f.getConfig();void 0!=f.getConfig().tracks&&0<f.getConfig().tracks.length&&
void 0!=f.getConfig().tracks[0].file&&f.setCurrentCaptions(1)}function Q(){var a=n.clientWidth,d=Math.pow(a/420,.6),b=c.fontSize*d;e.style.maxWidth=a+"px";e.style.fontSize=Math.round(b)+"px";e.style.lineHeight=Math.round(1.4*b)+"px";e.style.position="relative";m.style.maxWidth=a+"px";m.style.fontSize=Math.round(b)+"px";m.style.lineHeight=Math.round(1.4*b)+"px";m.style.position="relative";m.style.display="inline-block";m.style.margin="0px";m.style.padding="0px";r.style.maxWidth=a+"px";r.style.fontSize=
Math.round(b)+"px";r.style.lineHeight=Math.round(1.4*b)+"px";r.style.position="relative";r.style.display="inline-block";r.style.margin="14px 0";l.style.color="#40ff91";l.style.position="absolute";l.style.top="0px";l.style.left="0px";l.style.overflow="hidden";l.style.whiteSpace="nowrap";l.style.textShadow="-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black";l.style.lineHeight=Math.round(1.4*b)+"px";h.style.color="#40ff91";h.style.position="absolute";h.style.top="0px";h.style.left="0px";h.style.overflow=
"hidden";h.style.whiteSpace="nowrap";h.style.textShadow="-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black";h.style.lineHeight=Math.round(1.4*b)+"px";c.windowOpacity&&(y.style.padding=Math.round(5*d)+"px",y.style.borderRadius=Math.round(5*d)+"px")}function L(a,d,b){var c=a.text,g=d.text;d=/<br\s*[\/]?>/gi;var e=!1;c=(c||"").replace(d," ");g=g.replace(d," ");if(""!==c&&""!==g&&(b?(c!=l.innerHTML&&(l.style.width="0%",l.innerHTML=c,m.innerHTML=c),e||""!==h.innerHTML&&!z&&D||(e=!0,h.style.width="0%",
h.innerHTML=g,r.innerHTML=g),m.appendChild(l)):(z&&(l.innerHTML=g,m.innerHTML=g,h.innerHTML=c,r.innerHTML=c),r.appendChild(h)),c.length)){setTimeout(Q,16);var n=1,p=0;var q=Math.round(1E3*(a.endTime-a.startTime)/50);z&&(n=(A-a.startTime)*q/(a.endTime-a.startTime));var t=setInterval(function(){if("paused"!=f.getState())if(p=n/q*100,100<p&&(p=100),A<a.startTime||Math.floor(A)>Math.ceil(a.endTime)||!D)clearInterval(t),v>=k.length-1&&(l.style.width="100%",h.style.width="100%",m.appendChild(l),r.appendChild(h));
else if(b?(!e&&n>q/3&&v<k.length-2&&(e=!0,h.style.width="0%",h.innerHTML=g,r.innerHTML=g),l.style.width=p+"%"):(!e&&n>q/3&&v<k.length-2&&(e=!0,l.style.width="0%",l.innerHTML=g,m.innerHTML=g),h.style.width=p+"%"),n++,n>=q+1||z)clearInterval(t),b?v<k.length-1&&(h.style.width="0%"):v<k.length-1&&(l.style.width="0%")},50)}}function G(){for(var a=-1,d=0;d<k.length;d++)if(k[d].startTime<=A&&(d===k.length-1||k[d+1].startTime>=A)){a=d;break}if(-1===a)L("");else if(a!==v){v=a;d=!0;0==(a+1)/2%2&&(d=!1);var b=
v<k.length-2?k[a+2]:k[a-2];z&&""===k[a].text&&""===b.text&&(v=a=a<k.length-1?a+1:a-1,d=0==(a+1)/2%2?!1:!0,b=v<k.length-2?k[a+2]:k[a-2]);L(k[a],b,d)}}function I(a){a=String(a).replace("#","");3===a.length&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);return"#"+a.substr(-6)}function F(a,d){var b="rgb",c=[parseInt(a.substr(1,2),16),parseInt(a.substr(3,2),16),parseInt(a.substr(5,2),16)];void 0!==d&&100!==d&&(b+="a",c.push(d/100));return b+"("+c.join(",")+")"}"undefined"!==typeof GoPerformance&&"function"===typeof GoPerformance&&
GoPerformance(f,p,x);var t,C,w,u,q,c,k,n,y,e,m,l,r,h,v,z=!1,H=!1,D=!1;f.onReady(function(a){u=f.getContainer();x.style.position="absolute";x.style.top="40px";x.style.width="100%";x.style.overflow="hidden";x.style.pointerEvents="none";J("onReady")});f.onBeforePlay(function(a){a=u.getElementsByClassName("jw-title-primary")[0];if(void 0!=a){var c=a.innerHTML;0>c.indexOf("<font")&&0<c.indexOf(" - ")&&(c=c.replace(" - "," - <font color='#c7c7c7'>"),a.innerHTML=c+"</font>")}B()});f.on("meta",function(a){E("onMeta")});
f.on("visualQuality",function(a){void 0==q&&(q=u.getElementsByClassName("jw-icon-hd")[0].getElementsByClassName("jw-option"));"auto"!=a.mode&&"auto"!=a.reason||f.setCurrentQuality(a.level.index);0<q.length&&(a=q[0],"Auto"==a.innerHTML&&(a.className="jw-hidden"))});if(void 0===p.showVIP||!1===p.showVIP)f.on("firstFrame",N);else f.on("firstFrame",O),f.on("levelsChanged",P);f.on("time",function(a){A=a.position;k&&G();D||(a=f.getConfig().playlistItem.tracks,void 0!=a&&0<a.length&&void 0!=a[0].file&&E("onTime"))});
f.on("seek",function(a){z=!0;l.style.width="0%";h.style.width="0%"});f.on("seeked",function(a){z=!1});this.resize=function(a,c){};(function(){c=f.getCaptions();void 0==c.color&&(c.color="#FFFFFF");void 0==c.fontFamily&&(c.fontFamily="Roboto, Arial, sans-serif");c.fontOpacity=100;void 0==c.fontStyle&&(c.fontStyle="normal");void 0==c.fontWeight&&(c.fontWeight="normal");void 0==c.textDecoration&&(c.textDecoration="none");void 0==c.edgeStyle&&(c.edgeStyle="uniform");void 0==c.backgroundColor&&(c.backgroundColor=
"#000");void 0==c.windowColor&&(c.windowColor="#FFFFFF");c.fontSize=17;var a=c.fontOpacity,d=c.windowOpacity,b=c.edgeStyle,k=c.backgroundColor,g,p=F(I(c.color),a),q=c.fontFamily,t=c.fontStyle,v=c.fontWeight,w=c.textDecoration,u;d&&(g=F(I(c.windowColor),d));a=F("#000000",a);"dropshadow"===b?u="0 2px 1px "+a:"raised"===b?u="0 0 5px "+a+", 0 1px 5px "+a+", 0 2px 5px "+a:"depressed"===b?u="0 -2px 1px "+a:"uniform"===b&&(u="-2px 0 1px "+a+",2px 0 1px "+a+",0 -2px 1px "+a+",0 2px 1px "+a+",-1px 1px 1px "+
a+",1px 1px 1px "+a+",1px -1px 1px "+a+",1px 1px 1px "+a);c.back&&F(I(k),c.backgroundOpacity);n=document.createElement("div");y=document.createElement("div");e=document.createElement("div");m=document.createElement("p");l=document.createElement("span");r=document.createElement("p");h=document.createElement("span");e.appendChild(m);e.appendChild(document.createElement("br"));e.appendChild(r);n.style.display="block";n.style.height="auto";n.style.position="absolute";n.style.textAlign="center";n.style.width=
"100%";n.style.zIndex="1";y.style.display="inline-block";void 0!=g&&(y.style.backgroundColor=g);e.style.color=p;e.style.display="inline-block";e.style.fontFamily=q;e.style.fontStyle=t;e.style.fontWeight=v;e.style.textAlign="center";e.style.textDecoration=w;e.style.wordWrap="break-word";e.style.textShadow=u;y.appendChild(e);n.appendChild(y);x.appendChild(n)})();var A=0;k&&G()})})(jwplayer);
function setAutoNext(B){var f=jwplayer().getContainer();void 0!=f&&(f=f.getElementsByClassName("jw-icon-auto-next")[0],void 0!=f&&(f.className=B?"jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-auto-next jw-icon-auto-next-on":"jw-icon jw-icon-inline jw-button-color jw-reset jw-icon-auto-next jw-icon-auto-next-off"))};
